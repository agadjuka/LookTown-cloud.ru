"""
Сервис для удаления ID в скобках из текста сообщений
"""
import re


class IdCleaner:
    """Сервис для очистки текста от ID в скобках"""
    
    @staticmethod
    def remove_id_brackets(text: str) -> str:
        """
        Удаляет скобки с ID из текста.
        
        Ищет скобки (круглые, квадратные или фигурные), внутри которых есть:
        - Текст "ID" (регистронезависимо)
        - Набор цифр (обычно 7-8 цифр)
        
        Может быть в разных форматах:
        - (ID: 3409600)
        - (ID 16699751)
        - (ID3409600)
        - [ID: 3409600]
        - {ID: 3409600}
        
        Args:
            text: Текст с ID в скобках
            
        Returns:
            Текст без скобок с ID
        """
        if not text:
            return text
        
        # Паттерн для поиска ID в скобках
        # Ищем открывающую скобку, затем "ID" (регистронезависимо),
        # затем опционально пробел и двоеточие, затем пробел (опционально),
        # затем 7-8 цифр, затем закрывающую скобку
        # Поддерживаем круглые, квадратные и фигурные скобки
        patterns = [
            # Круглые скобки: (ID: 3409600), (ID 16699751), (ID3409600)
            r'\(ID\s*:?\s*\d{7,8}\)',
            # Квадратные скобки: [ID: 3409600], [ID 16699751], [ID3409600]
            r'\[ID\s*:?\s*\d{7,8}\]',
            # Фигурные скобки: {ID: 3409600}, {ID 16699751}, {ID3409600}
            r'\{ID\s*:?\s*\d{7,8}\}',
        ]
        
        result = text
        for pattern in patterns:
            # Заменяем все вхождения на пустую строку
            result = re.sub(pattern, '', result, flags=re.IGNORECASE)
        
        # Удаляем возможные двойные пробелы, оставшиеся после удаления
        result = re.sub(r'\s+', ' ', result)
        # Удаляем пробелы в начале и конце строк
        result = result.strip()
        
        return result


def remove_id_brackets_from_text(text: str) -> str:
    """
    Удобная функция для удаления ID в скобках из текста
    
    Args:
        text: Текст с ID в скобках
    
    Returns:
        Текст без скобок с ID
    """
    return IdCleaner.remove_id_brackets(text)

