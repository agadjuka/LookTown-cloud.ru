SDK для Python (boto) для работы с Object Storage
Эта статья полезна?


boto3 и boto — это наборы средств разработки для работы с сервисами AWS с поддержкой языков программирования Python 2.x и Python 3.x.

Для установки воспользуйтесь инструкциями в репозиториях boto3 и boto.

Перед началом работы
Для доступа к Object Storage подготовьте:

Tenant ID — идентификатор тенанта. Его можно скопировать на странице с бакетами.

Key ID (логин) и Key Secret (пароль) — формируются при создании персонального API-ключа или ключа сервисного аккаунта.

Endpoint — https://s3.cloud.ru.

Настройка
В домашнем каталоге создайте файл .aws/credentials и задайте в нем пару ключей в формате:


[default]
aws_access_key_id=<tenant_id>:<key_id>
aws_secret_access_key=<key_secret>

В файле .aws/config задайте регион и адрес хранилища:


[default]
region=ru-central-1
endpoint_url = https://s3.cloud.ru

Примеры операций

boto3

boto

#!/usr/bin/env python
#-*- coding: utf-8 -*-
import boto3
session = boto3.session.Session(profile_name='default')
s3 = session.client(
   service_name='s3',
   endpoint_url='<endpoint_url>'
)

# Создать новый бакет
s3.create_bucket(Bucket='my-bucket')

# Загрузить объекты в бакет из строки
s3.put_object(Bucket='my-bucket', Key='object_name', Body='EXAMPLE')

# Загрузить объекты в бакет из файла
s3.upload_file('/tmp/filename.txt', 'my-bucket', 'storage-filename.txt')
s3.upload_file('image.png', 'my-bucket', 'image-in-storage.png')
s3.upload_file('my_script.py', 'my-bucket', 'script/my_script.py')

# Получить список объектов в бакете
for key in s3.list_objects(Bucket='my-bucket')['Contents']:
   print(key['Key'])

# Получить объект
get_object_response = s3.get_object(Bucket='my-bucket',Key='object_name')
print(get_object_response['Body'].read())

# Удалить несколько объектов
forDeletion = [{'Key':'object_name'}, {'Key':'script/py_script.py'}]
response = s3.delete_objects(Bucket='my-bucket', Delete={'Objects': forDeletion})

# Удалить бакет и все объекты, включая их версии
s3_resource = boto3.resource(
   's3', endpoint_url='endpoint_url')
s3_bucket = s3_resource.Bucket('my-bucket')
bucket_versioning = s3_resource.BucketVersioning('my-bucket')
if bucket_versioning.status == 'Enabled':
   s3_bucket.object_versions.delete()
else:
   s3_bucket.objects.all().delete()
   s3_bucket.delete()